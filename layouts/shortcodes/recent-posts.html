{{ $limit := .Get "limit" | default 5 }}
{{ $includeAll := .Get "includeAll" | default false }}
{{ $pages := slice }}

{{ if $includeAll }}
  {{ $pages = where site.RegularPages "Section" "in" (slice "blog") }}
  {{ $pages = where $pages "Type" "!=" "section" }}
  {{ $pages = $pages.ByDate.Reverse }}
  {{ $pages = $pages | first $limit }}
{{ else }}
  {{ $currentSection := .Page.CurrentSection }}
  {{ $pages = $currentSection.RegularPages }}

  {{/* 현재 섹션에 글이 없으면 하위 섹션의 글들을 가져옴 */}}
  {{ if eq (len $pages) 0 }}
    {{ $allPages := slice }}
    {{ range $currentSection.Sections }}
      {{ $allPages = $allPages | append .RegularPages }}
      {{/* 2단계 하위 섹션도 체크 (backend/troubleshooting 등) */}}
      {{ range .Sections }}
        {{ $allPages = $allPages | append .RegularPages }}
      {{ end }}
    {{ end }}
    {{ $pages = $allPages }}
  {{ end }}

  {{ $pages = $pages.ByDate.Reverse }}
  {{ $pages = $pages | first $limit }}
{{ end }}

<div class="recent-posts">
  {{ range $pages }}
  <article class="hx-mb-4">
    <a href="{{ .RelPermalink }}" class="hx-block hx-p-4 hx-rounded-lg hx-border hx-border-gray-200 dark:hx-border-gray-800 hover:hx-border-primary-500 dark:hover:hx-border-primary-500 hx-transition-colors">
      <div class="hx-flex hx-justify-between hx-items-start hx-gap-4">
        <div class="hx-flex-1">
          <h3 class="hx-text-lg hx-font-semibold hx-mb-1">{{ .Title }}</h3>
          {{ with .Params.summary }}
          <p class="hx-text-gray-600 dark:hx-text-gray-400 hx-text-sm hx-mb-2">{{ . }}</p>
          {{ end }}
          <div class="hx-flex hx-gap-3 hx-text-xs hx-text-gray-500 dark:hx-text-gray-500">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006.01.02" }}</time>
            {{ with .Params.tags }}
            <div class="hx-flex hx-gap-2">
              {{ range first 3 . }}
              <span class="hx-px-2 hx-py-0.5 hx-rounded hx-bg-gray-100 dark:hx-bg-gray-800">#{{ . }}</span>
              {{ end }}
            </div>
            {{ end }}
          </div>
        </div>
      </div>
    </a>
  </article>
  {{ end }}
</div>
