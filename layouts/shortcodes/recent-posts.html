{{ $limit := .Get "limit" | default 5 }}
{{ $includeAll := .Get "includeAll" | default false }}
{{ $pages := slice }}

{{ if $includeAll }}
  {{ $pages = where site.RegularPages "Section" "in" (slice "blog") }}
  {{ $pages = where $pages "Type" "!=" "section" }}
  {{ $pages = $pages.ByDate.Reverse }}
  {{ $pages = $pages | first $limit }}
{{ else }}
  {{ $currentSection := .Page.CurrentSection }}
  {{ $pages = $currentSection.RegularPages }}

  {{/* 현재 섹션에 글이 없으면 하위 섹션의 글들을 가져옴 */}}
  {{ if eq (len $pages) 0 }}
    {{ $allPages := slice }}
    {{ range $currentSection.Sections }}
      {{ $allPages = $allPages | append .RegularPages }}
      {{/* 2단계 하위 섹션도 체크 (backend/troubleshooting 등) */}}
      {{ range .Sections }}
        {{ $allPages = $allPages | append .RegularPages }}
      {{ end }}
    {{ end }}
    {{ $pages = $allPages }}
  {{ end }}

  {{ $pages = $pages.ByDate.Reverse }}
  {{ $pages = $pages | first $limit }}
{{ end }}

{{- $readMore := (T "readMore") | default "Read more →" -}}
<div class="recent-posts">
  {{- range $pages }}
    <div class="hx:mb-10">
      <h3><a style="color: inherit; text-decoration: none;" class="hx:block hx:font-semibold hx:mt-8 hx:text-2xl" href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
      {{ if site.Params.blog.list.displayTags }}
        <div class="hx:text-sm hx:leading-7">
          {{ partial "tags.html" (dict "context" .) }}
        </div>
      {{ end }}
      {{- $description := partial "utils/page-description" . -}}
      {{- if gt (len $description) 200 -}}
        <p class="hx:opacity-80 hx:mt-4 hx:leading-7">{{ substr $description 0 200 }}...</p>
      {{- else -}}
        <p class="hx:opacity-80 hx:mt-4 hx:leading-7">{{ $description }}</p>
      {{- end -}}
      <p class="hx:opacity-80 hx:mt-1 hx:leading-7">
        <a class="hx:text-[color:hsl(var(--primary-hue),100%,50%)] hx:underline hx:underline-offset-2 hx:decoration-from-font" href="{{ .RelPermalink }}">
          {{- $readMore -}}
        </a>
      </p>
      <p class="hx:opacity-50 hx:text-sm hx:mt-4 hx:leading-7">{{ partial "utils/format-date" .Date }}</p>
    </div>
  {{ end -}}
</div>
